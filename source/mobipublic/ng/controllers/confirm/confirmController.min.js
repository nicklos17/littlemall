!function(){"use strict";var t=baseController.extend({init:function(t,e,o){return this._super(t),t.addAddr=!1,t.confirmData=JSON.parse(localStorage.getItem("confirmData")),t.inv_type="3",t.totalFee="0.00",t.cpsPay="0.00",t.payFee="0.00",t.shipPay="0.00",t.confirmData?("undefined"!=typeof t.confirmData.n?e.postRequest(shopModuleConfig.domain+"/order/buynow",{g:t.confirmData.g,a:t.confirmData.a,n:t.confirmData.n}).then(function(e){return 1!=e.ret?3==e.ret?(alert("商品库存不足,请重新购买"),o.path("/goods/"+t.confirmData.g),!1):(alert("请先选择购买的商品~"),o.path("/"),!1):(e.g.car_good_num=t.confirmData.n,t.goods={0:e.g},t.goodsLen=1,t.codeFlag=e.g.codeFlag,t.totalFee=(100*parseFloat(e.g.goods_price)*t.confirmData.n/100).toFixed(2),1==t.codeFlag&&(t.payFee="0.00",t.cpsPay=t.totalFee),void 0)},function(t){o.path("/cart")}):e.postRequest(shopModuleConfig.domain+"/order/buycart",{select:t.confirmData}).then(function(e){if(1==e.ret){t.goods=e.data,t.goodsLen=t.goods.length;for(var a in e.data)t.totalFee=((100*parseFloat(t.totalFee)+100*parseFloat(e.data[a].goods_price)*parseInt(e.data[a].car_good_num))/100).toFixed(2)}else{if(3==e.ret)return alert("您购物车某商品库存不足~"),o.path("/cart"),!1;o.path("/cart")}},function(t){o.path("/cart")}),e.getRequest(shopModuleConfig.domain+"/order/confirm").then(function(e){e.addressList?(t.addrChoose=e.addressList[0].u_addr_id,t.addressChoose(e.addressList[0].u_addr_id,e.addressList[0].pro_id)):t.payFee=t.totalFee-t.cpsPay,t.addrList=e.addressList},function(t){o.path("/cart")}),t.addressChoose=function(o,a){t.addrChoose=o,e.postRequest(shopModuleConfig.domain+"/order/getShipPay",{proId:a}).then(function(e){return 1!=e.ret?(alert("异常,请重试~"),!1):(t.shipPay=parseFloat(e.data).toFixed(2),void(t.payFee=((100*t.totalFee+100*t.shipPay-100*t.cpsPay)/100).toFixed(2)))},function(t){})},t.invType=function(e){t.inv_type=e},void(t.goOrder=function(){return t.invoice&&!t.inv_type?(alert("请填写发票抬头~"),!1):t.addrChoose?void e.postRequest(shopModuleConfig.domain+"/order/go",{is_inv:t.invoice?1:3,inv_type:t.inv_type,inv_title:t.invTitle?t.invTitle:"",add_id:t.addrChoose,memo:t.memo?t.memo:"",select:JSON.stringify(t.confirmData)}).then(function(e){1==e.ret?(t.confirmData=null,t.goods=null,localStorage.removeItem("confirmData"),void 0!=t.codeFlag&&1==t.codeFlag?o.path("/order"):o.path("/success")):3==e.ret?(alert("您购物车某商品库存不足~"),o.path("/cart")):(alert(e.msg),o.path("/cart"))},function(t){o.path("/cart")}):(alert("请选择地址~"),!1)})):void o.path("/cart")},defineListeners:function(){this._super()},destroy:function(){}});t.$inject=["$scope","uriServices","$location"],angular.module("controllers.confirm",[]).controller("confirmCtrl",t)}();