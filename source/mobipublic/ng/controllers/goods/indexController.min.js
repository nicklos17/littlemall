!function(){"use strict";var o=baseController.extend({init:function(o,t,e,i){this._super(o);var r=e.gid;t.getRequest(shopModuleConfig.domain+"/goods/index/"+r).then(function(t){1==t.ret?(o.goodsInfo=t,o.showImg=t.gInfo.goods_img):i.path("/")},function(o){i.path("/goods/"+r)}),o.disCol=[],o.disSize=[],o.goodsNum=1,o.filterSize=function(e){o.sizeCur!=e.gaAttr.attrs_id&&-1==o.disSize.indexOf(e.gaAttr.attrs_id)&&(o.sizeCur=e.gaAttr.attrs_id,o.colCur&&o.sizeCur&&(o.showSizeCol=!1),t.postRequest(shopModuleConfig.domain+"/goods/filterSize",{gid:r,"filter-id":e.gaAttr.attrs_id,"parent-other-id":document.getElementById("pCol").value}).then(function(t){return o.disCol=t,!1},function(o){i.path("/goods/"+r)}))},o.filterCol=function(e){o.colCur!=e.gaAttr.attrs_id&&-1==o.disCol.indexOf(e.gaAttr.attrs_id)&&(o.colCur=e.gaAttr.attrs_id,o.colCur&&o.sizeCur&&(o.showSizeCol=!1),t.postRequest(shopModuleConfig.domain+"/goods/filterCol",{gid:r,"filter-id":e.gaAttr.attrs_id,"parent-other-id":document.getElementById("pSize").value}).then(function(t){return o.disSize=t,o.showImg=e.gaAttr.attrs_img.replace("thumb","original"),!1},function(o){i.path("/goods/"+r)}))},o.numRdc=function(){o.goodsNum>1&&o.goodsNum--},o.numAdd=function(){o.goodsNum<20&&o.goodsNum++},o.addCart=function(){return void 0!=o.goodsInfo.codeFlag&&1==o.goodsInfo.codeFlag?(alert("使用优惠券不支持加入购物车"),!1):o.colCur&&o.sizeCur?o.goodsNum<1||o.goodsNum>20?(alert("请先选择正确的购买数量~"),!1):void t.postRequest(shopModuleConfig.domain+"/cart/add",{gid:r,"attrs-ids":o.colCur+","+o.sizeCur,num:o.goodsNum}).then(function(o){1==o.ret?i.path("/cart"):3==o.ret?alert("购物车不能超过50件商品~"):5==o.ret?alert("单个商品最大购买量不能超过20~"):alert("商品库存不足~")},function(o){i.path("/cart/")}):(o.showSizeCol=!0,!1)},o.buy=function(){return o.colCur&&o.sizeCur?(localStorage.setItem("confirmData",JSON.stringify({g:r,a:o.colCur+","+o.sizeCur,n:o.goodsNum})),void i.path("/confirm")):(o.showSizeCol=!0,!1)}},defineListeners:function(){this._super()},destroy:function(){}});o.$inject=["$scope","uriServices","$routeParams","$location"],angular.module("controllers.goods",[]).controller("goodsCtrl",o)}();